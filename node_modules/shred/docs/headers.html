<!DOCTYPE html>  <html> <head>   <title>headers.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="examples.html">                 examples.js               </a>                                           <a class="source" href="shred.html">                 shred.js               </a>                                           <a class="source" href="content.html">                 content.js               </a>                                           <a class="source" href="headers.html">                 headers.js               </a>                                           <a class="source" href="parseUri.html">                 parseUri.js               </a>                                           <a class="source" href="request.html">                 request.js               </a>                                           <a class="source" href="response.html">                 response.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               headers.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>The header mixins allow you to add HTTP header support to any object. This
might seem pointless: why not simply use a hash? The main reason is that, per
the <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.2">HTTP spec</a>,
headers are case-insensitive. So, for example, <code>content-type</code> is the same as
<code>CONTENT-TYPE</code> which is the same as <code>Content-Type</code>. Since there is no way to
overload the index operator in Javascript, using a hash to represent the
headers means it's possible to have two conflicting values for a single
header.</p>

<p>The solution to this is to provide explicit methods to set or get headers.
This also has the benefit of allowing us to introduce additional variations,
including snake case, which we automatically convert to what Matthew King has
dubbed "corset case" - the hyphen-separated names with initial caps:
<code>Content-Type</code>. We use corset-case just in case we're dealing with servers
that haven't properly implemented the spec.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;underscore&quot;</span><span class="p">)</span>
<span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Convert headers to corset-case. <strong>Example:</strong> <code>CONTENT-TYPE</code> will be converted
to <code>Content-Type</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">corsetCase</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">string</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^|-)(\w)/g</span><span class="p">,</span> 
          <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span> <span class="p">});</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>We suspect that <code>initializeHeaders</code> was once more complicated ...</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">initializeHeaders</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{};</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Access the <code>_headers</code> property using lazy initialization. <strong>Warning:</strong> If you
mix this into an object that is using the <code>_headers</code> property already, you're
going to have trouble.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">$H</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">object</span><span class="p">.</span><span class="nx">_headers</span><span class="o">||</span><span class="p">(</span><span class="nx">object</span><span class="p">.</span><span class="nx">_headers</span><span class="o">=</span><span class="nx">initializeHeaders</span><span class="p">(</span><span class="nx">object</span><span class="p">));</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Hide the implementations as private functions, separate from how we expose them.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>The "real" <code>getHeader</code> function: get the header after normalizing the name.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">getHeader</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">$H</span><span class="p">(</span><span class="nx">object</span><span class="p">)[</span><span class="nx">corsetCase</span><span class="p">(</span><span class="nx">name</span><span class="p">)];</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>The "real" <code>getHeader</code> function: get one or more headers, or all of them
if you don't ask for any specifics. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">getHeaders</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span><span class="nx">names</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="p">(</span><span class="nx">names</span> <span class="o">&amp;&amp;</span> <span class="nx">names</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="nx">names</span> <span class="o">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">$H</span><span class="p">(</span><span class="nx">object</span><span class="p">));</span>
  <span class="kd">var</span> <span class="nx">hash</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">hash</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">getHeader</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span><span class="nx">key</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">hash</span><span class="p">;</span>
  <span class="p">},{});</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Freeze the resulting hash so you don't mistakenly think you're modifying
the real headers.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nb">Object</span><span class="p">.</span><span class="nx">freeze</span><span class="p">(</span><span class="nx">hash</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">hash</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>The "real" <code>setHeader</code> function: set a header, after normalizing the name.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">setHeader</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span><span class="nx">name</span><span class="p">,</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$H</span><span class="p">(</span><span class="nx">object</span><span class="p">)[</span><span class="nx">corsetCase</span><span class="p">(</span><span class="nx">name</span><span class="p">)]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">object</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>The "real" <code>setHeaders</code> function: set multiple headers based on a hash.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">setHeaders</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span><span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span><span class="p">(</span> <span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">hash</span> <span class="p">)</span> <span class="p">{</span> <span class="nx">setHeader</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span><span class="nx">key</span><span class="p">,</span><span class="nx">hash</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span> <span class="p">};</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Here's where we actually bind the functionality to an object. These mixins work by
exposing mixin functions. Each function mixes in a specific batch of features.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Add getters.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">getters</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">constructor</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getHeader</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">getHeader</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">name</span><span class="p">);</span> <span class="p">};</span>
    <span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getHeaders</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">getHeaders</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">_</span><span class="p">(</span><span class="nx">arguments</span><span class="p">));</span> <span class="p">};</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Add setters but as "private" methods.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">privateSetters</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">constructor</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_setHeader</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">setHeader</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">key</span><span class="p">,</span><span class="nx">value</span><span class="p">);</span> <span class="p">};</span>
    <span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_setHeaders</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">hash</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">setHeaders</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">hash</span><span class="p">);</span> <span class="p">};</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Add setters.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">setters</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">constructor</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setHeader</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">setHeader</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">key</span><span class="p">,</span><span class="nx">value</span><span class="p">);</span> <span class="p">};</span>
    <span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setHeaders</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">hash</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">setHeaders</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">hash</span><span class="p">);</span> <span class="p">};</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Add both getters and setters.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">gettersAndSetters</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">constructor</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getHeader</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">getHeader</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">name</span><span class="p">);</span> <span class="p">};</span>
    <span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getHeaders</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">getHeaders</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">_</span><span class="p">(</span><span class="nx">arguments</span><span class="p">));</span> <span class="p">};</span>
    <span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setHeader</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">setHeader</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">key</span><span class="p">,</span><span class="nx">value</span><span class="p">);</span> <span class="p">};</span>
    <span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setHeaders</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">hash</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">setHeaders</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">hash</span><span class="p">);</span> <span class="p">};</span>
  <span class="p">},</span>
<span class="p">};</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 